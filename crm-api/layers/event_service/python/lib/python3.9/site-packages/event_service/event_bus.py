import boto3
from datetime import datetime, timezone
import json
from uuid import uuid4
from os import environ

client = boto3.client('events')

ENVIRONMENT = environ.get('ENVIRONMENT')

def generate_event_id():
    return str(uuid4())

def send_event(source: str, payload: object) -> None:
    client.put_events(
        Entries=[
            {
                'Time': datetime.now(timezone.utc).isoformat(),
                'Source': source,
                'DetailType': 'JSON',
                'Detail': json.dumps(payload),
                'EventBusName': f'wbns-bus-{"prod" if ENVIRONMENT == "prod" else "test"}'
            }
        ]
    )